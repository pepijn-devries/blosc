<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Blosc Compression • blosc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Blosc Compression">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">blosc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.6.0004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/blosc-compression.html">Blosc Compression</a></li>
    <li><a class="dropdown-item" href="../articles/dtypes.html">Data Types</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pepijn-devries/blosc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Blosc Compression</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pepijn-devries/blosc/blob/master/vignettes/blosc-compression.Rmd" class="external-link"><code>vignettes/blosc-compression.Rmd</code></a></small>
      <div class="d-none name"><code>blosc-compression.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="compress-with-blosc">Compress with Blosc<a class="anchor" aria-label="anchor" href="#compress-with-blosc"></a>
</h2>
<div class="section level3">
<h3 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h3>
<p>When your input data is of type <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code>, it is assumed
that it encodes a data type where each element is <code>typesize</code>
bytes long. The data type can be any structured form of data and does
not necessarily needs to be known. Of course you need to know the
structure when you need to interpret the data, but that’s not up to the
Blosc compressor.</p>
<p>The example below compresses the <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code> data assuming
that the data type is 2 bytes long.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pepijn-devries.github.io/blosc/">blosc</a></span><span class="op">)</span></span>
<span><span class="va">data_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/raw.html" class="external-link">as.raw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/blosc.html">blosc_compress</a></span><span class="op">(</span><span class="va">data_input</span>, typesize <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 02 01 12 02 08 00 00 00 08 00 00 00 18 00 00 00 01 02 03 04 01 02 03 04</span></span></code></pre></div>
<p>Note that the length of the resulting data is actually longer than
that of the input data. This is because the compressor has an overhead.
The data set is just too small compared to the overhead.</p>
<p>Can you compress other data types with Blosc? Yes you can. You first
have to encode it to a binary form (<code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code>), with for
instance <code><a href="../reference/dtype.html">r_to_dtype()</a></code> or any other method that converts
your data into a <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code> format. You can also use the
<code>dtype</code> argument to encode and compress your data in one go.
In that case you need to specify an appropriate data type
(<code><a href="../articles/dtypes.html">vignette("dtypes")</a></code>).</p>
<p>The example below shows how to encode <code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code> values
as little-endian 16 bit floating point data (<code>"&lt;f2"</code>) and
compresses it.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The line below won't work as the default `typesize` (4) does</span></span>
<span><span class="co">## not match with the dtype size (2)</span></span>
<span><span class="co">## blosc_compress(iris$Petal.Length, dtype = "&lt;f2")</span></span>
<span></span>
<span><span class="co">## Explicitely set the `typesize` to 2</span></span>
<span><span class="va">compressed_iris</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/blosc.html">blosc_compress</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Petal.Length</span>, typesize <span class="op">=</span> <span class="fl">2</span>, dtype <span class="op">=</span> <span class="st">"&lt;f2"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p>The output is always a vector of <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code> data. Generally,
the output data should be smaller than the input data. There are
exceptions. One is seen above, where the data set is too small in
comparison with the compressor overhead. Another case is where the data
is just too random, where the compressor algorithm simply can’t compress
the data. In the its compressed form, the data can no longer be
interpreted directly. You need to decompress it first
(<code><a href="../reference/blosc.html">blosc_decompress()</a></code>).</p>
</div>
<div class="section level3">
<h3 id="compression-algorithms">Compression Algorithms<a class="anchor" aria-label="anchor" href="#compression-algorithms"></a>
</h3>
<p>You can pick from several algorithms to compress your data:
<code>"blosclz"</code>, <code>"lz4"</code>, <code>"lz4hc"</code>,
<code>"zlib"</code>, or <code>"zstd"</code>. There is not a single
algorithm that always has the best performance (speed and compression
level). It really depends on your data and can be tested by trial and
error. You can also lower the compression <code>level</code> argument if
you prefer speed over compression level.</p>
</div>
</div>
<div class="section level2">
<h2 id="decompress-with-blosc">Decompress with Blosc<a class="anchor" aria-label="anchor" href="#decompress-with-blosc"></a>
</h2>
<div class="section level3">
<h3 id="input-data-1">Input data<a class="anchor" aria-label="anchor" href="#input-data-1"></a>
</h3>
<p>The decompression function (<code><a href="../reference/blosc.html">blosc_decompress()</a></code>) only
accepts <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code> data that has been compressed with Blosc. It
doesn’t have to be created in <code>R</code>, it can be generated with
any software using the <a href="https://github.com/Blosc/c-blosc" class="external-link">c-blosc library</a>.</p>
<p>You don’t have to specify the compression algorithm, typesize or
anything else. All that information is embedded in the header of the raw
input data. You can even retrieve this information with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/blosc_info.html">blosc_info</a></span><span class="op">(</span> <span class="va">compressed_iris</span> <span class="op">)</span></span>
<span><span class="co">#&gt; $Compressor</span></span>
<span><span class="co">#&gt; [1] "BloscLZ"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Blosc format version`</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Internal compressor version`</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Type size in bytes`</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Block size in bytes`</span></span>
<span><span class="co">#&gt; [1] 300</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Uncompressed size in bytes`</span></span>
<span><span class="co">#&gt; [1] 300</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Compressed size in bytes`</span></span>
<span><span class="co">#&gt; [1] 316</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Shuffle</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Pure memcpy`</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Bit shuffle`</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "blosc_info" "list"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="output-1">Output<a class="anchor" aria-label="anchor" href="#output-1"></a>
</h3>
<p>If you don’t specify the output type, the decompression routine
returns <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code> data. Do you remember the iris length data
that we compressed earlier? We can simply decompress it by calling
<code><a href="../reference/blosc.html">blosc_decompress()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_length1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blosc.html">blosc_decompress</a></span><span class="op">(</span><span class="va">compressed_iris</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">iris_length1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 99 3d 99 3d 33 3d</span></span></code></pre></div>
<p>It works, but we got <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code> data as output. This is
because the decompressor knows little about the data structure of the
decompressed data. Since we know that we have encoded it as
little-endian 16 bit floating point values (<code>"&lt;f2"</code>), we
can specify it as such. Once specified, the function will automatically
decode the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_length2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/blosc.html">blosc_decompress</a></span><span class="op">(</span><span class="va">compressed_iris</span>, dtype <span class="op">=</span> <span class="st">"&lt;f2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">iris_length2</span><span class="op">)</span></span></code></pre></div>
<p><img src="blosc-compression_files/figure-html/decompress-type-1.png" width="50%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pepijn de Vries.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
